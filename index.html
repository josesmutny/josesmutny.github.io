<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Draggable List</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
            background-color: #f4f4f9;
        }

        .controls {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }

        button {
            padding: 10px 15px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #007bff;
            color: white;
            transition: background-color 0.2s;
        }

        button:hover {
            background-color: #0056b3;
        }

        #draggable-list {
            list-style: none;
            padding: 0;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: white;
        }

        .list-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            cursor: grab;
            background-color: #ffffff;
            transition: transform 0.3s, opacity 0.3s, background-color 0.2s;
            position: relative;
        }

        .list-item:last-child {
            border-bottom: none;
        }

        .list-item:active {
            cursor: grabbing;
        }

        .list-item.dragging {
            opacity: 0.5;
            background-color: #e0f7fa; /* Slightly highlight the dragging item */
        }

        .drop-placeholder {
            height: 50px; /* Same height as list-item */
            background-color: #add8e6; /* Light blue */
            border: 2px dashed #007bff;
            margin: 5px 0;
            opacity: 0;
            transition: opacity 0.2s, height 0.3s;
        }

        .drop-placeholder.visible {
            opacity: 1;
            /* Height is already set, transition works when added/removed */
        }
    </style>
</head>
<body>

    <div class="controls">
        <button id="copy-button">Copy Ordered List</button>
        <button id="reset-button">Reset Order</button>
    </div>

    <ul id="draggable-list">
        </ul>

    <script>
        const initialEntries = [
          [
    { "id": 1, "value": "Cerny pasazer" },
    { "id": 2, "value": "Mela jsem ja pejska" },
    { "id": 3, "value": "Lasko (kryl)" },
    { "id": 4, "value": "Ved me dal..." },
    { "id": 5, "value": "Podvod" },
    { "id": 6, "value": "Prazskej demon" },
    { "id": 7, "value": "Zkouška dospělosti" },
    { "id": 8, "value": "Tri cunatka" },
    { "id": 9, "value": "Jacek" },
    { "id": 10, "value": "Zahrada ticha" },
    { "id": 11, "value": "Medvědi nevědí" },
    { "id": 12, "value": "Buraky" },
    { "id": 13, "value": "Panenka (poutníci)" },
    { "id": 14, "value": "Citronky" },
    { "id": 15, "value": "Pověste ho vejš" },
    { "id": 16, "value": "Ja, pisnicka" },
    { "id": 17, "value": "Povidej" },
    { "id": 18, "value": "Tu kytaru jsem koupil kvuli tobe" },
    { "id": 19, "value": "Růže z Texasu" },
    { "id": 20, "value": "Dezolat" },
    { "id": 21, "value": "Válečná" },
    { "id": 22, "value": "Vecernicek" },
    { "id": 23, "value": "Hudsonské šífy" },
    { "id": 24, "value": "Stanky" },
    { "id": 25, "value": "Píseň zhrzeného trampa" },
    { "id": 26, "value": "Srouby a matice" },
    { "id": 27, "value": "Z Petěrburg" },
    { "id": 28, "value": "Zabili, zabili" },
    { "id": 29, "value": "Hlupaku najdu te" },
    { "id": 30, "value": "Aux champs elysées" },
    { "id": 31, "value": "Cesta?" },
    { "id": 32, "value": "Hruška" },
    { "id": 33, "value": "Vysoký jalovec" },
    { "id": 34, "value": "Sova sněžná" },
    { "id": 35, "value": "to ta helpa" },
    { "id": 36, "value": "veličenstvo kat" },
    { "id": 37, "value": "lojza a líza" },
    { "id": 38, "value": "Bratříčku zavírej vrátka?" },
    { "id": 39, "value": "Riptide" },
    { "id": 40, "value": "Where is my mind" }
]
        ];

        let currentEntries = [...initialEntries];
        const list = document.getElementById('draggable-list');
        const copyButton = document.getElementById('copy-button');
        const resetButton = document.getElementById('reset-button');
        let draggedItem = null;
        let placeholder = null;

        function renderList() {
            list.innerHTML = '';
            currentEntries.forEach(entry => {
                const item = document.createElement('li');
                item.className = 'list-item';
                item.draggable = true;
                item.dataset.id = entry.id;
                item.textContent = entry.value;

                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragend', handleDragEnd);
                list.appendChild(item);
            });
        }

        function createPlaceholder() {
            if (!placeholder) {
                placeholder = document.createElement('div');
                placeholder.className = 'drop-placeholder';
            }
            return placeholder;
        }

        function handleDragStart(e) {
            draggedItem = this;
            setTimeout(() => {
                this.classList.add('dragging');
            }, 0); // Delay to allow the item to be "picked up" before changing its style
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
            draggedItem = null;
            if (placeholder && placeholder.parentElement) {
                placeholder.remove();
            }
            updateListOrder();
        }

        function updateListOrder() {
            const items = Array.from(list.querySelectorAll('.list-item'));
            currentEntries = items.map(item => {
                const id = parseInt(item.dataset.id);
                return initialEntries.find(entry => entry.id === id);
            }).filter(entry => entry !== undefined); // Rebuild currentEntries based on DOM order
            console.log('New Order:', currentEntries.map(e => e.value));
        }

        list.addEventListener('dragover', (e) => {
            e.preventDefault(); // Necessary to allow dropping
            if (!draggedItem) return;

            const afterElement = getDragAfterElement(list, e.clientY);
            const currentPlaceholder = createPlaceholder();

            // Insert placeholder
            if (afterElement == null) {
                // If dragging to the end
                if (list.lastChild !== currentPlaceholder) {
                    list.appendChild(currentPlaceholder);
                }
            } else {
                // If dragging before another element
                if (afterElement.previousSibling !== currentPlaceholder) {
                    list.insertBefore(currentPlaceholder, afterElement);
                }
            }

            // Ensure placeholder is visible
            currentPlaceholder.classList.add('visible');
            e.dataTransfer.dropEffect = 'move';
        });

        list.addEventListener('dragleave', (e) => {
            // Optional: remove placeholder if drag leaves the whole list area
            // However, keeping it visible until drop or dragend offers better visual guidance
        });

        list.addEventListener('drop', (e) => {
            e.preventDefault();
            if (!draggedItem) return;

            // Remove placeholder visibility
            if (placeholder) {
                placeholder.classList.remove('visible');
            }

            // Determine where to drop the dragged item
            const afterElement = getDragAfterElement(list, e.clientY);

            if (afterElement == null) {
                list.appendChild(draggedItem);
            } else {
                list.insertBefore(draggedItem, afterElement);
            }

            // Remove the placeholder from the DOM after dropping the item
            if (placeholder && placeholder.parentElement) {
                placeholder.remove();
            }

            // The dragend listener will call updateListOrder
        });

        function getDragAfterElement(container, y) {
            const draggableItems = Array.from(container.querySelectorAll('.list-item:not(.dragging)'));
            
            // Include placeholder in the calculation if it's visible, to get the correct drop position
            const items = draggableItems.filter(item => item !== draggedItem);

            return items.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        // --- Button Functions ---

        copyButton.addEventListener('click', () => {
            const result = currentEntries.map((entry, index) => {
                return `${entry.value}, ${index + 1}`; // Index is 1-based position
            }).join('\n');

            navigator.clipboard.writeText(result)
                .catch(err => {
                    console.error('Could not copy text: ', err);
                    alert('Failed to copy to clipboard. Check console for details.');
                });
        });

        resetButton.addEventListener('click', () => {
            currentEntries = [...initialEntries];
            renderList();
        });

        // Initial render
        renderList();
    </script>

</body>
</html>
